<html>
<head>
<style>
*{padding: 0; margin:0;}
canvas{ background: #eee ; display: block; margin: 0 auto;}
</style>
</head>

<body>
<canvas id= "myCanvas" width="800" height="600"></canvas>
<script type="text/javascript">
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);

var tank1 = new Image();
tank1.src = "tank1.png";
var tank2 = new Image();
tank2.src = "tank2.png";
var player1X = 200;
var player1Y = 200;
var player1Rotation = 0;
var player1H = 30;
var player1W = 40;
var player2X = 300;
var player2Y = 200;
var player2Rotation = 0;
var player2H = 30;
var player2W = 40;
var upPressed = false;
var downPressed = false;
var rightPressed = false;
var leftPressed = false;
var shiftPressed = false;
var upPressed2 = false;
var downPressed2 = false;
var rightPressed2 = false;
var leftPressed2 = false;
var spacePressed = false;
var bullets = [];
var canFire = true;

function drawImageRot(img, x, y, width, height, deg)
{
	var rad = deg * Math.PI/ 180; // convert deg to radian
	ctx.translate(x + width/ 2, y + height /2); //set orgin to center of image
	ctx.rotate(rad); //rotate the canvas around the origin
	ctx.drawImage(img,width/ 2 * (-1), height / 2 * (-1), width, height); // draws the image
	//resets the canvas
	ctx.rotate(rad * (-1));
	ctx.translate((x + width / 2) * (-1), (y + height/2) * (-1));
}


function keyDownHandler(e)
{
	if(e.keyCode == 38)
	{
		upPressed = true;
		downPressed = false;
	}
	if(e.keyCode == 40)
	{
		downPressed = true;
		upPressed = false;
	}
	if(e.keyCode == 37)
	{
		leftPressed = true;
		rightPressed = false;
	}
	if(e.keyCode == 39)
	{
		rightPressed = true;
		leftPressed = false;
	}
	if(e.keyCode == 16)
	{
		shiftPressed = true;
	}
	if(e.keyCode == 87)
	{
		upPressed2 = true;
		downPressed2 = false;
	}
	if(e.keyCode == 83)
	{
		downPressed2 = true;
		upPressed2 = false;
	}
	if(e.keyCode == 65)
	{
		leftPressed2 = true;
		rightPressed2 = false;
	}
	if(e.keyCode == 68)
	{
		rightPressed2 = true;
		leftPressed2 = false;
	}
	if(e.keyCode == 32)
	{
		spacePressed = true;
	}
}

function keyUpHandler(e)
{
	if(e.keyCode == 38)
	{
		upPressed = false;
	}
	if(e.keyCode == 40)
	{
		downPressed = false;
	}
	if(e.keyCode == 37)
	{
		leftPressed = false;
	}
	if(e.keyCode == 39)
	{
		rightPressed = false;
	}
	if(e.keyCode == 16)
	{
		shiftPressed = false;
	}
	if(e.keyCode == 87)
	{
		upPressed2 = false;
	}
	if(e.keyCode == 83)
	{
		downPressed2 = false;
	}
	if(e.keyCode == 65)
	{
		leftPressed2 = false;
	}
	if(e.keyCode == 68)
	{
		rightPressed2 = false;
	}
	if(e.keyCode == 32)
	{
		spacePressed = false;
	}
}



function controls()
{
	if(leftPressed)
	{
		player1Rotation -= 1;
	}
	if(rightPressed)
	{
		player1Rotation += 1;
	}
	if(upPressed)
	{
		player1X += Math.cos((player1Rotation) * Math.PI/180);
		player1Y += Math.sin((player1Rotation) * Math.PI/180);
	}
	if(downPressed)
	{
		player1X -= Math.cos((player1Rotation) * Math.PI/180);
		player1Y -= Math.sin((player1Rotation) * Math.PI/180);
	}
	if(shiftPressed && canFire) //bullet(x, y, speed, rotation)
	{
		var x1 = player1X + (.65 * player1W);
		var y1 = player1Y + (.5 * player1H);
		bullets.push(new Bullet(x1, y1, 1, player1Rotation));
		canFire = false;
	}
}

function controls2()
{
	if(leftPressed2)
	{
		player2Rotation -= 1;
	}
	if(rightPressed2)
	{
		player2Rotation += 1;
	}
	if(upPressed2)
	{
		player2X += Math.cos((player2Rotation) * Math.PI/180);
		player2Y += Math.sin((player2Rotation) * Math.PI/180);
	}
	if(downPressed2)
	{
		player2X -= Math.cos((player2Rotation) * Math.PI/180);
		player2Y -= Math.sin((player2Rotation) * Math.PI/180);
	}
	if(spacePressed && canFire) //bullet(x, y, speed, rotation)
	{
		var x1 = player2X + (.65 * player2W);
		var y1 = player2Y + (.5 * player2H);
		bullets.push(new Bullet(x1, y1, 1, player2Rotation));
		canFire = false;
	}
}

function drawBullets()
{
	for(var i = 0; i < bullets.length; i++)
	{
		ctx.fillStyle = "green";
		ctx.fillRect(bullets[i].x, bullets[i].y, 3, 3);
		bullets[i].speed = 2;
		bullets[i].x += bullets[i].speed * Math.cos((bullets[i].rotation) * Math.PI/180);
		bullets[i].y += bullets[i].speed * Math.sin((bullets[i].rotation) * Math.PI/180);
		if(bullets[i].x <= 0)
		{
			bullets[i].rotation = (bullets[i].rotation * (-1)) + 180;
		}
		if(bullets[i].x >= 800)
		{
			bullets[i].rotation = (bullets[i].rotation * (-1)) + 180;
		}
		if(bullets[i].y <= 0)
		{
			bullets[i].rotation = (bullets[i].rotation * (-1)) + 360;
		}
		if(bullets[i].y >= 600)
		{
			bullets[i].rotation = (bullets[i].rotation * (-1)) + 360;
		}
	}
}

function Bullet(x, y, speed, rotation)
{
	this.x = x;
	this.y = y;
	this.speed = speed;
	this.rotation = rotation;
}

function resetBullet()
{
	canFire = true;
}

function draw()
{
	ctx.clearRect(0,0,800,600);
	controls();
	controls2();
	//drawImageRot(img, x, y, width, height, deg)
	drawImageRot(tank1, player1X, player1Y,player1W, player1H, player1Rotation);
	drawImageRot(tank2, player2X, player2Y,player2W, player2H, player2Rotation);
	drawBullets();
}



setInterval(draw, 10);
setInterval(resetBullet, 1000);
</script>
</body>
</html>